---
title:  "Gov 50 Final Project"
author: "Patrick Pieper"
description: This project investigates the carbon emissions data across various countries since '1751', focusing on identifying and visualizing the differences in emissions. The objective is to pinpoint the highest emitters, compare emissions amongst countries, and highlight the gap between them. 
output:
  distill::distill_article:
    self_contained: false
---


## Project thoughts

I was initially interested in the varying levels of carbon emissions across time. However, when reading the data, I was more intrigued by the difference in countries, as opposed to the difference over time. This led me to a broader investigation aiming to visualize and understand the emissions data better. In doing so, i hope to discover significant insights regarding the emissions spectrum - where countries stand and the gaps that exist between them.


## Data Sources

The primary data source for this project is the CO2 emissions data set retrieved from Datahub, within the scope of a project by the Carbon Dioxide Information Analysis Center (CDIAC). This data set contains historical emissions data - recorded yearly across countries - which allows for a comprehensive analysis observing time and country. The data was accessed using R and relevant packages, such as 'jasonlite'.


## Proposal
The goal is to analyze and visualize the carbon emissions data to draw meaningful comparisons between countries, particularly focusing on the top 10 emitters. The analysis will highlight the emissions difference between adjacent countries on the list, providing a visual representation of the emissions gap. This analysis would open the door for a deeper investigation into the policies and factors contributing to the emissions levels in these countries - potentially also allowing for comparison with related metrics, such as GDP. 

Based on the global emissions data, I anticipate that the key emitters will be predominantly industrialized countries, many of which will be categorized as 'Western'. In addition, BRICS countries should also be up on the list. I also expect the difference in emissions to be more significant the higher a country's emissions are.





```{r}
install.packages("jsonlite", repos="https://cran.rstudio.com/")
library("jsonlite")

json_file <- 'https://datahub.io/core/co2-fossil-by-nation/datapackage.json'
json_data <- fromJSON(paste(readLines(json_file), collapse=""))

# get list of all resources:
print(json_data$resources$name)

# print all tabular data(if exists any)
for(i in 1:length(json_data$resources$datahub$type)){
  if(json_data$resources$datahub$type[i]=='derived/csv'){
    path_to_file = json_data$resources$path[i]
    data <- read.csv(url(path_to_file))
    }
}
```


```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(broom)
library(modelsummary)
```

```{r}
unique_countries <- data |>
  distinct(Country)
```

SHOWCASE HOW DATA PRESENTED

#total emissions for each country across all years

```{r}
total_emissions <- data |>
  group_by(Country) |>
  summarise(total_emissions = sum(Total, na.rm = TRUE)) |>
  arrange(desc(total_emissions))

```


#visual representation of total emissions for each country across all years

```{r}
average_emissions <- mean(total_emissions$total_emissions, na.rm=TRUE)

total_emissions |>
ggplot(aes(x = reorder(Country, -total_emissions), y = total_emissions)) +
  geom_col() +
  geom_hline(yintercept = average_emissions) +
  labs(
    x="Country",
    y="Total Emissions",
    title="Total Emissions by Country"
  )
```


#filtered data and averages

```{r}
top10_emissions <- total_emissions |>
  arrange(-total_emissions) |>
  slice(c(1:10))

knitr::kable(top10_emissions)
        
average_emissions_top10 <- mean(top10_emissions$total_emissions)
average_emissions_total <- mean(total_emissions$total_emissions)
```


#Bar Chart 

```{r}
top10_emissions |>
  ggplot(aes(x = reorder(Country, -total_emissions), y = total_emissions)) +
  geom_bar(stat = "identity") +
  geom_hline(aes(yintercept = average_emissions_total, linetype = "Average for All Countries", color="indianred")) +
  geom_hline(aes(yintercept = average_emissions_top10, linetype = "Average for Top 10 Countries", color="dodgerblue")) +
  labs(x="Country", y="Total Emissions", title="Top 10 Total Emissions by Country") +
  scale_linetype_manual(values=c("Average for All Countries" = "dashed", "Average for Top 10 Countries" = "dotted"), name="Average Line") +
  guides(color = FALSE) + #Remove color legend
  theme(axis.text.x = element_text(angle=45, hjust=1, size=6))
```

The graph showcases the vast difference in emissions among the top 10 countries.The United States - in total over the last ~280 years - has produced more than twice as many emissions than China, in 2nd place. The significant disparity in emissions among these large-scale emitters and the descending trend in emissions values for subsequent countries seems to confirm my assumption that there exists a positive correlation between the amount of emissions and the difference in emissions to a lower country. This trend would indicate that countries producing little emissions have similar data to their neighbors - referring to an arranged order according to emissions.

Comparing the average emissions of these top 10 players to the global average can offer insight into the overall contribution of these 10 to global emissions as well. Using these two approaches, one may substantiate claims that despite being a small number of countries, top emitters are responsible for a disproportionate amount of global emissions - this being more true the closer a country is to the "highest emitter position".

#GDP

```{r}
df<-read.csv("DP_LIVE_16112023222414417.csv")

unique_location <- df |>
  distinct(LOCATION)

```

#total GDP by Country

```{r}
total_gdp <- df |>
  group_by(LOCATION) |>
  summarise(total_gdp = sum(Value, na.rm = TRUE)) |>
  arrange(desc(total_gdp))
```

#table with total GDP by country

```{r}
average_gdp <- mean(total_gdp$total_gdp, na.rm=TRUE)

total_gdp |>
ggplot(aes(x = reorder(LOCATION, -total_gdp), y = total_gdp)) +
  geom_col() +
  geom_hline(yintercept = average_gdp) +
  labs(
    x="Country",
    y="Total GDP",
    title="Total GDP by Country"
  )
```

#same 10 countries total gdp

```{r}
top_10_emissions_gdp <- total_gdp |>
  filter(LOCATION %in% c("USA", "CHN", "RUS", "GBR", "JPN", "DEU", "IND", "FRA", "CAN"))

knitr::kable(top_10_emissions_gdp)

average_gdp_top_10_emissions_gdp <- mean(top_10_emissions_gdp$total_gdp)
average_gdp_total <- mean(total_gdp$total_gdp)
```

#Visual Representation of #same 10 countries total GDP

```{r}
top_10_emissions_gdp |>
  ggplot(aes(x = reorder(LOCATION, -total_gdp), y = total_gdp)) +
  geom_bar(stat = "identity") +
  geom_hline(aes(yintercept = average_gdp_total, linetype = "Average for All Countries", color="indianred")) +
  geom_hline(aes(yintercept = average_gdp_top_10_emissions_gdp, linetype = "Average for Top 10 Countries", color="dodgerblue")) +
  labs(x="Country", y="Total GDP", title="Top 10 Total Emission Countries GDP by Country") +
  scale_linetype_manual(values=c("Average for All Countries" = "dashed", "Average for Top 10 Countries" = "dotted"), name="Average Line") +
  guides(color = FALSE) + #Remove color legend
  theme(axis.text.x = element_text(angle=45, hjust=1, size=6))
```

#1992-2014 total gdp and total emissions (solves USSR problem and data only available until 2014)

#filter (years) emissions and GDP, aggregate data, identify top 9

```{r}
emissions_filtered <- data |>
  filter(Year >= 1992, Year <= 2014)


total_emissions_1992_2014 <- emissions_filtered |>
  group_by(Country) |>
  summarise(total_emissions = sum(Total, na.rm = TRUE)) |>
  arrange(desc(total_emissions))


top9_emitters <- head(total_emissions_1992_2014, 9)

knitr::kable(top9_emitters)
```

#filter and aggregate GDP
```{r}
unique_countries_gdp <- df |>
  distinct(LOCATION) |>
  arrange(LOCATION)
```


```{r}
gdp_filtered <- df |>
  filter(TIME >= 1992, TIME <= 2014, LOCATION %in% c("CHN", "USA", "RUS", "IND", "JPN", "DEU", "GBR", "CAN", "KOR"))

total_gdp_1992_2014 <- gdp_filtered |>
  group_by(LOCATION) |>
  summarise(Total_GDP = sum(Value, na.rm = TRUE)) |>
  arrange(- Total_GDP)
knitr::kable(total_gdp_1992_2014)

```

# Merged Data

```{r}
emissions_gdp_data <- data.frame(
  Country = c("China", "USA", "Russia", "India", "Japan", "Germany", "UK", "Canada", "Korea"),
  Total_Emissions = c(35489190, 33931362, 10466421, 7964623, 7524624, 5096108, 3249675, 3242871, 2890885),
  Total_GDP = c(161277918, 271880877, 41382019, 75717911, 88956166, 60368485, 42279981, 25127316, 25760099)
)


knitr::kable(emissions_gdp_data)
```

Given the succinct variety in data presentation across the two data sets, for the sake of data integrity and consistency I have refrained from trying to merge the 2 data sets through code. The reason for doing so, is due to the "Country" and "LOCATION" variables not being consistent - not only in name, but taking into consideration the shift in borders (prime examples being the USSR -> Russia and Yugoslavia -> Balkan Countries) it would be unwise to temper with the data and assume the same principles were followed by the two research groups. As I will refer to in my reflection, having a longer list of countries to compare GDP growth with carbon emissions would be helpful in establishing a global consensus and improve statistical significance, the limitation elaborated on above led to my decision of focusing on top emitters and leading economies - valuing quality over quantity of data. An attempt in resolving the problem - not including each country - will be introduced later on, after the current approach has been completed.

#linear regression analysis

```{r}
model <- lm(Total_GDP ~ Total_Emissions, data = emissions_gdp_data)
summary(model)
```
```{r}
modelsummary::modelsummary(model, stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01), title = "Regression Model Summary")
```

Based on the Regression Model Summary we can interpret the outputs in context of our research. The intercept - ~19.8 billion - is the expected value of GDP in $ (our dependent variable) when all independent variables are 0. The standard error - ~17.6 billion ~ indicates the variability of this estimate. The closeness of the two values indicates that there is a significant range in values - as can be confirmed by the visual representation below. The Total_emissions variable - 5.594 - indicates that for every unitary increases in Total Emissions (our independent variable) GDP increases by an average of ~5.6 units, with a standard error of ~1. This degree of certainty, along with the three astersks marking representing a high statistical significance (p<0.1), allows us to conclude that an increase in carbon emissions has a significant positive effect on GDP growth. The number of observations, 9, refers to the countries we chose - based on top emitters (from 1992 to 2014). Our R-squared value, 0.812, suggests that ~81.2% of the change in GDP can be allocated to the model. Meanwhile, the adjusted R-squared value (0.786) - adjusting for number of predictors, and arguably a more precise measurement - indicates that ~78.6% of the change in GDP can be explained by the model.The Root Mean Square Error predicts that observed GDP values are off the model's predictions by an average of ~ 33 million (USD).


```{r}
emissions_gdp_data |>
  ggplot(aes(x = Total_Emissions, y = Total_GDP)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(title = "Relationship between Total Emissions and Total GDP", x = "Total Emissions in metric tons)", y = "Total GDP (in USD)")
```

The positive slope of the regression line indicates a positive correlation between Total Emissions and Total GDP for the top 9 countries by emissions - in accordance with our observations from our modelsummary. This confirms my assumption that countries producing greater volumes of emissions have a higher GDP growth than countries with lower emissions. The confidence interval - represented by the shaded line - appears to be narrow enough/confirm the indications of the regression line, although this must be confirmed with statistical reasoning, such as the p-value and R-squared value, which we have done above.

Whilst these regression tools confirm my hypothesis, I addressed earlier that focusing on the top emitters/GDP countries limits the number of observations to base our analysis on. For reasons discussed earlier, merging the entire data sets would lead to discrepancies, however, as an alternative I decided to observe the rate of change within total GDP and total emissions, based on ranking.

To approach this, I ranked the total emissions/total GDP and subtracted each value from its predecessor: value of n - value of n+1, where n is the rank of a country, and the value is either total GDP or total emissions. Visualizing this difference, shows us the rate of decline in total emissions/GDP based on the size of emissions/GDP. If my hypothesis is right, our results from above hold true, total GDP/emissions decline faster among those countries with higher GDP/emissions than for those with lower values. We will stick to the total from the years 1992-2014 to allow for a later comparison.

#ranking GDP/Emissions and assigning rank

```{r}
emissions_ranked <- data |>
  group_by(Country) |>
  summarize(total_emissions_ranking = sum(Total)) |>
  arrange(desc(total_emissions_ranking)) |>
  mutate(Emissions_Rank = row_number())

#limitation: USSR/Russia etc.

gdp_ranked <- df |>
  group_by(LOCATION) |>
  summarize(total_gdp_ranking = sum(Value)) |>
  arrange(desc(total_gdp_ranking)) |>
  mutate(GDP_Rank = row_number())

#limitation: OECD etc..
```

#calculating rate of change across ranks

```{r}
emissions_change <- emissions_ranked |>
  mutate(Change_in_Emissions = abs(total_emissions_ranking - lag(total_emissions_ranking)))
emissions_change

gdp_change <- gdp_ranked |>
  mutate(Change_in_GDP = abs(total_gdp_ranking - lag(total_gdp_ranking)))
gdp_change
```

#viualization of rate of change

```{r}
emissions_change |>
  ggplot(aes(x=Emissions_Rank, y = Change_in_Emissions)) +
  geom_line() +
  labs(title = "Rate of Change in Emissions by Rank", x = "Emissions Rank", y = "Change in Emissions")

gdp_change |>
  ggplot(aes(x=GDP_Rank, y = Change_in_GDP)) +
  geom_line() +
  labs(title = "Rate of Change in GDP by Rank", x = "GDP Rank", y = "Change in GDP")
```


Plotting the Rate of Change in Emissions by Rank and Rate of Change in GDP by Rank confirms my assumption - the rate of change being more higher/more significant at higher ranks - between countries with higher GDP/emissions - and declining as total emissions/GDP declines. The decline in rate of change is very extreme for both measures - although GDP sees a noticeable fluctuation in earlier ranks. Nevertheless, the trend is clear - the greatest rate of change exists for the highest ranking emitters/those with the highest GDP values. This trend again indicates that a select few countries are responsible for the large part of emissions, and represent a majority of world GDP.

I used the absolute value for difference for the sake of visualization - having a positive values reaching 0 appears more intuitive than a graph beginning in the extreme negative and reaching 0. Additionally, I would have liked to plot the two rate of change against each other, but having a different number of observations, 67 and 256, does not allow for this kind of (effective) analysis.


Conclusion





